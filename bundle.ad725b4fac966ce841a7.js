(()=>{"use strict";var e={24:(e,t)=>{function n(e){return"object"==typeof e&&null!==e&&"string"==typeof e.name}function a(e){return"object"==typeof e&&null!==e&&"number"==typeof e.wins}Object.defineProperty(t,"__esModule",{value:!0}),t.isCar=n,t.isCars=function(e){var t;return!(!Array.isArray(e)||null===e)&&(!(Array.isArray(e)&&!e.every((e=>n(e))))&&("string"==typeof(null===(t=e[0])||void 0===t?void 0:t.name)||0===e.length))},t.isEngine=function(e){return"object"==typeof e&&null!==e&&"number"==typeof e.velocity},t.isWinner=a,t.isWinners=function(e){var t;return!(!Array.isArray(e)||null===e)&&(!(Array.isArray(e)&&!e.every((e=>a(e))))&&("number"==typeof(null===(t=e[0])||void 0===t?void 0:t.wins)||0===e.length))},t.isGarageState=function(e){return"object"==typeof e&&null!==e&&"string"==typeof e.createCarName},t.isWinnersState=function(e){return"object"==typeof e&&null!==e&&"string"==typeof e.winsSort}},172:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});const a=n.p+"33d2f757bd156b2a4fc9f82b759f4619.svg"},257:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});const a=n.p+"1f7458b93f389fc2e32c36b97d6e9648.svg"},289:(e,t,n)=>{n.r(t)},627:function(e,t,n){var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(s,i){function r(e){try{c(a.next(e))}catch(e){i(e)}}function o(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,o)}c((a=a.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Winners=void 0;const i=n(708),r=n(888),o=n(902),c=n(699),l=n(24),u=n(646),d=s(n(790)),h=s(n(257)),m=n(805);function g(e){e instanceof HTMLElement&&(e.dataset.sort="",[...e.children].forEach((e=>e.remove())))}function p(e){let t="",n="";return e.timeSort?(t="time",n=e.timeSort):e.winsSort&&(t="wins",n=e.winsSort),[t,n]}function f(e){const t=e.dataset.sort;"ASC"===t&&e instanceof HTMLElement?([...e.children].forEach((e=>e.remove())),e.append(v())):"DESC"===t&&e instanceof HTMLElement&&([...e.children].forEach((e=>e.remove())),e.append(C()))}function v(){const e=new i.ElementBase({tag:"span",className:["sort-icon-up"]}).element;return e instanceof HTMLElement&&(e.style.backgroundImage=`url(${d.default})`),e}function C(){const e=new i.ElementBase({tag:"span",className:["sort-icon-down"]}).element;return e instanceof HTMLElement&&(e.style.backgroundImage=`url(${h.default})`),e}t.Winners=class{constructor(e,t,n){this.state=n,this.winnersCount=0,this.api=new o.WinnersAPI,this.apiCars=new c.GarageAPI;const a=this.state.getWinnersState(),s=a?a.pageNumber:1;this.pagination=new m.Pagination(10,s),this.winnersContainer=new i.ElementBase({tag:"div",className:["winners-container"]}).element,this.winners=new i.ElementBase({tag:"div",className:["winners"]}).element,this.configurePage(e,t)}configurePage(e,t){const n=this.createWinnersPageMenu(t);e.main instanceof Element&&(e.main.append(n,this.winnersContainer),this.createWinnersComponents().then((()=>this.createWinnersContainer(this.pagination.pageNumber))).catch((e=>console.log(e))))}createWinnersContainer(e){const t=new i.ElementBase({tag:"p",className:["winners-title"],textContent:`Winners (${this.winnersCount})`}).element,n=new i.ElementBase({tag:"p",className:["winners-page-number"],textContent:`Page #${e}`}).element;this.winnersContainer.append(t,n,this.winners,this.createPaginationButtons())}createPaginationButtons(){const e=new i.ElementBase({tag:"div",className:["pagination-buttons"]}).element,t=new r.Button({className:["prev-button","button"],textContent:"Prev",handlerFunction:()=>{this.prevButtonHandler()}}).element,n=new r.Button({className:["next-button","button"],textContent:"Next",handlerFunction:()=>{this.nextButtonHandler()}}).element;return t instanceof HTMLButtonElement&&n instanceof HTMLButtonElement&&(this.pagination.setPrevButtonState(t),this.pagination.setNextButtonState(n,this.winnersCount)),e.append(t,n),e}nextButtonHandler(){this.clearWinnersContainer(),this.clearWinners(),this.pagination.pageNumber+=1,this.createWinnersComponents().then((()=>{this.createWinnersContainer(this.pagination.pageNumber),this.saveWinnersState()})).catch((e=>console.log(e)))}prevButtonHandler(){this.clearWinnersContainer(),this.clearWinners(),this.pagination.pageNumber-=1,this.createWinnersComponents().then((()=>{this.createWinnersContainer(this.pagination.pageNumber),this.saveWinnersState()})).catch((e=>console.log(e)))}createWinnersComponents(){return a(this,void 0,void 0,(function*(){this.createTableHeader(),yield this.populateWinnersTable()}))}createTableHeader(){const e=new i.ElementBase({tag:"p",className:["header-number","winners-header"],textContent:"Number"}).element,t=new i.ElementBase({tag:"p",className:["header-name","winners-header"],textContent:"Name"}).element,n=new i.ElementBase({tag:"p",className:["header-car","winners-header"],textContent:"Car"}).element,a=new i.ElementBase({tag:"p",className:["header-time","winners-header"],textContent:"Wins"}).element,s=new i.ElementBase({tag:"p",className:["header-time","winners-header"],textContent:"Best Time"}).element;a.addEventListener("click",(()=>{s&&g(s),this.showSortedWinners(a,"wins"),this.saveWinnersState()})),s.addEventListener("click",(()=>{a&&g(a),this.showSortedWinners(s,"time"),this.saveWinnersState()})),this.setSortingFromState(a,s),this.winners.append(e,t,n,a,s)}showSortedWinners(e,t){this.clearWinnersWithoutHeader();let n="";e.dataset.sort&&"DESC"!==e.dataset.sort?(n="DESC",e.dataset.sort="DESC",e instanceof HTMLElement&&([...e.children].forEach((e=>e.remove())),e.append(C()))):(n="ASC",e.dataset.sort="ASC",e instanceof HTMLElement&&([...e.children].forEach((e=>e.remove())),e.append(v()))),this.sortByColumnHandler(t,n).then((e=>console.log(e))).catch((e=>console.log(e)))}sortByColumnHandler(e,t){return a(this,void 0,void 0,(function*(){const n=(yield this.api.sortWinners(this.pagination.pageNumber,e,t))[0],a=[];(0,l.isWinners)(n)&&(n.forEach((e=>{a.push(this.apiCars.getCar(e.id))})),Promise.all(a).then((e=>e.forEach(((e,t)=>{(0,l.isCar)(e)&&this.createWinnerRow(t+1,e,n[t])})))).catch((e=>console.log(e))))}))}createWinnerRow(e,t,n){const a=new i.ElementBase({tag:"p",className:["data-number","data"],textContent:`${e}`}).element,s=new i.ElementBase({tag:"p",className:["data-name","data"],textContent:`${t.name}`}).element,r=(0,u.createCarImage)(t.color),o=new i.ElementBase({tag:"p",className:["data-wins","data"],textContent:`${n.wins}`}).element,c=new i.ElementBase({tag:"p",className:["data-time","data"],textContent:`${n.time}`}).element;this.winners.append(a,s,r,o,c)}populateWinnersTable(){return a(this,void 0,void 0,(function*(){const e=this.state.getWinnersState();let t;if(e){const n=p(e)[0],a=p(e)[1];t=n&&a?yield this.api.sortWinners(this.pagination.pageNumber,n,a):yield this.api.getWinners(this.pagination.pageNumber)}else t=yield this.api.getWinners(this.pagination.pageNumber);const n=t[0],a=t[1];a instanceof Headers&&(this.winnersCount=Number(a.get("X-Total-Count")));const s=[];(0,l.isWinners)(n)&&(n.forEach((e=>{s.push(this.apiCars.getCar(e.id))})),Promise.all(s).then((e=>e.forEach(((e,t)=>{(0,l.isCar)(e)&&this.createWinnerRow(t+1,e,n[t])})))).catch((e=>console.log(e))))}))}clearWinnersContainer(){[...this.winnersContainer.children].forEach((e=>e.remove()))}clearWinners(){[...this.winners.children].forEach((e=>e.remove()))}clearWinnersWithoutHeader(){[...this.winners.children].slice(5).forEach((e=>e.remove()))}saveWinnersState(){const e=this.pagination.pageNumber;let t="",n="";const a=[...this.winners.children];a[3]instanceof HTMLElement&&(t=a[3].dataset.sort?a[3].dataset.sort:""),a[4]instanceof HTMLElement&&(n=a[4].dataset.sort?a[4].dataset.sort:"");const s={pageNumber:e,winsSort:t,timeSort:n};this.state.saveWinnersState(s)}createTopLevelButtons(e){return new r.Button({className:["garage-button","button"],textContent:"To Garage",handlerFunction:()=>{this.saveWinnersState(),e.openPage("/")}}).element}createWinnersPageMenu(e){const t=new i.ElementBase({tag:"div",className:["winners-page-menu"]}).element;return t.append(this.createTopLevelButtons(e)),t}setSortingFromState(e,t){const n=this.state.getWinnersState();n&&(e.dataset.sort=n.winsSort,t.dataset.sort=n.timeSort,f(e),f(t))}}},646:function(e,t,n){var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(s,i){function r(e){try{c(a.next(e))}catch(e){i(e)}}function o(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,o)}c((a=a.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GaragePage=void 0,t.createCarImage=C;const i=n(708),r=n(888),o=n(699),c=n(24),l=n(761),u=s(n(172)),d=n(902),h=n(805);function m(e){const t=[...e.children];g(t),function(e){const t=e[0];t instanceof HTMLButtonElement&&(t.disabled=!1)}(t)}function g(e){const t=e[1];t instanceof HTMLButtonElement&&(t.disabled=!0)}function p(){return new i.ElementBase({tag:"div",className:["cars"]}).element}function f(){const e=["A","B","C","D","E","F",0,1,2,3,4,5,6,7,8,9];let t="";for(let n=0;n<6;n+=1)t+=e[Math.floor(16*Math.random())];return`#${t}`}function v(e,t){const n=t.querySelector(".car-image");n instanceof HTMLElement&&(n.style.transform=`translate(${e}px)`)}function C(e){const t=new i.ElementBase({tag:"span",className:["car-image"]}).element;return t.innerHTML=`<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"\n\t viewBox="0 0 17.485 17.485" xml:space="preserve">\n<g>\n\t<g>\n\t\t<path style="fill:${e};" d="M17.477,8.149c-0.079-0.739-3.976-0.581-3.976-0.581L11.853,5.23H4.275L3.168,7.567H0v2.404\n\t\t\tl2.029,0.682c0.123-0.836,0.843-1.48,1.711-1.48c0.939,0,1.704,0.751,1.73,1.685l6.62,0.041c0.004-0.951,0.779-1.726,1.733-1.726\n\t\t\tc0.854,0,1.563,0.623,1.704,1.439l1.479-0.17C17.006,10.442,17.556,8.887,17.477,8.149z M4.007,7.568l0.746-1.771h2.864\n\t\t\tl0.471,1.771H4.007z M8.484,7.568L8.01,5.797h3.67l1.137,1.771H8.484z"/>\n\t\t<circle style="fill:#030104;" cx="3.759" cy="10.966" r="1.289"/>\n\t\t<circle style="fill:#030104;" cx="13.827" cy="10.9" r="1.29"/>\n\t</g>\n</g>\n</svg>`,t}t.GaragePage=class{constructor(e,t,n){this.state=n,this.winner=null,this.isRace=!1,this.carsNumber=0,this.api=new o.GarageAPI,this.apiWinners=new d.WinnersAPI;const a=this.state.getGarageState();if(a){this.selectedCarId=a.selectedCarId;const e=a.pageNumber;this.pagination=new h.Pagination(7,e)}else this.pagination=new h.Pagination(7,1),this.selectedCarId=0;this.createRowContainer=new i.ElementBase({tag:"div",className:["create-car-row"]}).element,this.createCarForm(),this.updateRowContainer=new i.ElementBase({tag:"div",className:["update-car-row"]}).element,this.updateCarForm(),this.carsContainer=p(),this.garageContainer=new i.ElementBase({tag:"div",className:["garage"]}).element,this.getCarsNumber().then((()=>{this.createGarageContainer(this.pagination.pageNumber),this.configurePage(e,t)})).catch((e=>console.log(e)))}configurePage(e,t){const n=this.createGaragePageMenu(t);e.main instanceof Element&&e.main.append(n,this.garageContainer),this.populateGarage(this.pagination.pageNumber)}createCarHandler(){return a(this,void 0,void 0,(function*(){const e={name:"",color:""},t=[...this.createRowContainer.children];if(t[0]instanceof HTMLInputElement&&t[1]instanceof HTMLInputElement){const n=t[0].value,a=t[1].value;e.name=n,e.color=a;const s=yield this.api.createCar(e);this.carsNumber+=1,this.setCarsNumber(this.carsNumber),this.getCarsCountOnPage()<7&&(0,c.isCar)(s)&&this.createCarRecord(s)}}))}createCarForm(){const e=new i.ElementBase({tag:"input",className:["create-car-input"]}).element,t=new i.ElementBase({tag:"input",className:["create-car-color"]}).element;t instanceof HTMLInputElement&&(t.type="color");const n=new r.Button({className:["create-car"],textContent:"Create",handlerFunction:()=>{this.createCarHandler().then((e=>e),(e=>console.log(e)))}}).element;if(e instanceof HTMLInputElement&&t instanceof HTMLInputElement){const n=this.state.getGarageState();n&&(e.value=n.createCarName,t.value=n.createCarColor),e.addEventListener("change",(()=>this.saveGarageState())),t.addEventListener("change",(()=>this.saveGarageState()))}this.createRowContainer.append(e,t,n)}createForm(){const e=new i.ElementBase({tag:"div",className:["garage-form"]}).element;return e.append(this.createRowContainer,this.updateRowContainer),e}updateCarForm(){const e=new i.ElementBase({tag:"input",className:["update-car-input"]}).element,t=new i.ElementBase({tag:"input",className:["update-car-color"]}).element,n=new r.Button({className:["update-car"],textContent:"Update",handlerFunction:()=>{this.updateCarRecordHandler()}}).element;if(e instanceof HTMLInputElement&&t instanceof HTMLInputElement){const n=this.state.getGarageState();n&&(e.value=n.updateCarName,t.value=n.updateCarColor),t.type="color",e.addEventListener("change",(()=>this.saveGarageState())),t.addEventListener("change",(()=>this.saveGarageState()))}this.updateRowContainer.append(e,t,n)}createGaragePageMenu(e){const t=new i.ElementBase({tag:"div",className:["garage-page-menu"]}).element;return t.append(this.createTopLevelButtons(e),this.createForm(),this.createBottomLevelButtons()),t}createCarRecord(e){const t=new i.ElementBase({tag:"div",className:["car-row"]}).element;t.dataset.id=e.id.toString();const n=this.createCarRecordTopMenu(e.name),a=this.createCarMainContent(e.color);t.append(n,a),this.carsContainer.append(t)}populateGarage(e){return a(this,void 0,void 0,(function*(){const t=yield this.api.getCars(e);(0,c.isCars)(t)&&t.forEach((e=>this.createCarRecord(e)))}))}getCarsCountOnPage(){return this.carsContainer.children.length}createGarageContainer(e){const t=new i.ElementBase({tag:"p",className:["garage-title"],textContent:`Garage (${this.carsNumber})`}).element,n=new i.ElementBase({tag:"p",className:["garage-page-number"],textContent:`Page #${e}`}).element;this.garageContainer.append(t,n,this.carsContainer,this.createPaginationButtons())}clearGarage(){[...this.garageContainer.children].forEach((e=>e.remove()))}clearCars(){[...this.carsContainer.children].forEach((e=>e.remove()))}createPaginationButtons(){const e=new i.ElementBase({tag:"div",className:["pagination-buttons"]}).element,t=new r.Button({className:["prev-button","button"],textContent:"Prev",handlerFunction:()=>{this.clearGarage(),this.carsContainer=p(),this.pagination.pageNumber-=1,this.createGarageContainer(this.pagination.pageNumber),this.populateGarage(this.pagination.pageNumber).then((()=>this.saveGarageState())).catch((e=>console.log(e)))}}).element;t instanceof HTMLButtonElement&&this.pagination.setPrevButtonState(t);const n=new r.Button({className:["next-button","button"],textContent:"Next",handlerFunction:()=>{this.clearGarage(),this.carsContainer=p(),this.pagination.pageNumber+=1,this.createGarageContainer(this.pagination.pageNumber),this.populateGarage(this.pagination.pageNumber).then((()=>this.saveGarageState())).catch((e=>console.log(e)))}}).element;return n instanceof HTMLButtonElement&&this.pagination.setNextButtonState(n,this.carsNumber),e.append(t,n),e}createCarRecordTopMenu(e){const t=new i.ElementBase({tag:"div",className:["car-menu"]}).element,n=new r.Button({className:["select-button"],textContent:"Select",handlerFunction:e=>{this.selectCarRecordHandler(e).then((()=>this.saveGarageState())).catch((e=>console.log(e)))}}).element,a=new r.Button({className:["remove-button"],textContent:"Remove",handlerFunction:e=>{this.removeCarRecordHandler(e)}}).element,s=new i.ElementBase({tag:"p",className:["car-name"],textContent:e}).element;return t.append(n,a,s),t}removeCarRecordHandler(e){return a(this,void 0,void 0,(function*(){var t;let n;if(e){const a=e.target;if(a instanceof Node){const e=null===(t=a.parentElement)||void 0===t?void 0:t.parentElement;if(e instanceof Element&&e.dataset){n=Number(e.dataset.id),yield this.api.removeCar(n),yield this.apiWinners.removeWinner(n),this.carsNumber-=1,this.setCarsNumber(this.carsNumber),this.clearCars(),yield this.populateGarage(this.pagination.pageNumber);const t=this.garageContainer.querySelector(".next-button");t instanceof HTMLButtonElement&&this.pagination.setNextButtonState(t,this.carsNumber)}}}}))}selectCarRecordHandler(e){return a(this,void 0,void 0,(function*(){var t;if(e){const n=e.target;if(n instanceof Node){const e=null===(t=n.parentElement)||void 0===t?void 0:t.parentElement;if(e instanceof Element&&e.dataset){this.selectedCarId=Number(e.dataset.id);const t=yield this.api.getCar(this.selectedCarId);if((0,c.isCar)(t)){const e=[...this.updateRowContainer.children];e[0]instanceof HTMLInputElement&&e[1]instanceof HTMLInputElement&&(e[0].value=t.name,e[1].value=t.color)}}}}}))}updateCarRecordHandler(){return a(this,void 0,void 0,(function*(){const e=[...this.updateRowContainer.children];let t,n;e[0]instanceof HTMLInputElement&&e[1]instanceof HTMLInputElement&&(t=e[0].value,n=e[1].value,yield this.api.updateCar(this.selectedCarId,{name:t,color:n}),this.clearCars(),yield this.populateGarage(this.pagination.pageNumber))}))}generateRandomCars(){return a(this,void 0,void 0,(function*(){for(let e=0;e<100;e+=1){const e={name:l.cars[Math.floor(Math.random()*l.cars.length)]+" "+l.models[Math.floor(Math.random()*l.models.length)],color:f()},t=yield this.api.createCar(e);this.getCarsCountOnPage()<this.pagination.limit&&(0,c.isCar)(t)&&this.createCarRecord(t)}yield this.getCarsNumber(),this.setCarsNumber(this.carsNumber)}))}createBottomLevelButtons(){const e=new i.ElementBase({tag:"div",className:["garage-page-bottom-buttons"]}).element,t=new r.Button({className:["race-button","button"],textContent:"Race",handlerFunction:()=>{this.startRaceHandler()}}).element,n=new r.Button({className:["reset-button","button"],textContent:"Reset",handlerFunction:()=>{this.stopAllCarsHandler()}}).element,a=new r.Button({className:["generate-cars-button","button"],textContent:"Generate Cars",handlerFunction:()=>{this.generateRandomCars()}}).element;return e.append(t,n,a),e}getAllCarsCount(){return a(this,void 0,void 0,(function*(){let e;const t=yield this.api.getAllCars();return(0,c.isCars)(t)?(e=t.length,e):0}))}setCarsNumber(e){[...this.garageContainer.children][0].textContent=`Garage (${e})`}getCarsNumber(){return a(this,void 0,void 0,(function*(){this.carsNumber=yield this.getAllCarsCount()}))}startCarHandler(e){var t;if(e){this.isRace=!1;const n=e.target;if(n instanceof Node){const e=null===(t=n.parentElement)||void 0===t?void 0:t.parentElement;if(e instanceof Element&&e.dataset){const t=Number(e.dataset.id);this.api.startEngine(t).then((n=>{if((0,c.isEngine)(n)){const a=n.distance/n.velocity;e.dataset.state="",this.startCar(a,e),this.api.driveEngine(t).then((t=>{t.ok?t.ok&&console.log("finish animation"):e.dataset.state="stopped"})).catch((e=>console.log(e)))}})).catch((e=>console.log(e)))}}}}stopCarHandler(e){var t;if(e){const n=e.target;if(n instanceof Node){const e=null===(t=n.parentElement)||void 0===t?void 0:t.parentElement;if(e instanceof Element&&e.dataset){const t=Number(e.dataset.id);this.api.stopEngine(t).then((t=>{(0,c.isEngine)(t)&&(e.dataset.state="stopped",v(0,e),m([...e.children][1]))})).catch((e=>console.log(e)))}}}}createCarMainContent(e){const t=new i.ElementBase({tag:"div",className:["car-main"]}).element,n=new r.Button({className:["start-button"],textContent:"A",handlerFunction:e=>{this.startCarHandler(e)}}).element,a=new r.Button({className:["stop-button"],textContent:"B",handlerFunction:e=>{this.stopCarHandler(e)}}).element,s=C(e),o=new i.ElementBase({tag:"span",className:["flag-image"]}).element;return o.style.backgroundImage=`url(${u.default})`,t.append(n,a,s,o),g(t.children),t}startRaceHandler(){this.winner=null;const e=[...this.carsContainer.children],t=[];for(let n=0;n<this.carsContainer.children.length;n+=1){const a=e[n];if(a instanceof HTMLElement){const e=Number(a.dataset.id);t.push(this.api.startEngine(e))}}Promise.all(t).then((t=>{e.forEach(((e,n)=>{if(e instanceof HTMLElement&&(e.dataset.state="started",this.isRace=!0),(0,c.isEngine)(t[n])){const a=t[n].distance/t[n].velocity;if(this.startCar(a,e),e instanceof HTMLElement){const t=Number(e.dataset.id);this.api.driveEngine(t).then((t=>{t.ok||(e.dataset.state="stopped")})).catch((e=>console.log(e)))}}}))})).catch((e=>console.log(e)))}stopAllCarsHandler(){const e=[...this.carsContainer.children],t=this.carsContainer.children.length,n=[];for(let a=0;a<t;a+=1){const t=e[a];if(t instanceof HTMLElement){const e=Number(t.dataset.id);n.push(this.api.stopEngine(e))}}Promise.all(n).then((()=>{e.forEach((e=>{e instanceof HTMLElement&&(e.dataset.state="stopped",v(0,e),m([...e.children][1]))}))})).catch((e=>console.log(e)))}animateCar(e,t,n,a){const s=(e-t)/n,i=s*(a.clientWidth-130);s<1&&a instanceof HTMLElement?"stopped"!==a.dataset.state&&(v(i,a),requestAnimationFrame((e=>this.animateCar(e,t,n,a)))):this.isRace&&null===this.winner&&(console.log("winner is"),a instanceof HTMLElement&&(this.winner=a),console.log(a),this.showWinMessage(n,a),this.saveWinner(n,a).then((e=>console.log(e))).catch((e=>console.log(e))))}startCar(e,t){const n=performance.now();!function(e){const t=[...e.children];(function(e){const t=e[0];t instanceof HTMLButtonElement&&(t.disabled=!0)})(t),function(e){const t=e[1];t instanceof HTMLButtonElement&&(t.disabled=!1)}(t)}([...t.children][1]),requestAnimationFrame((a=>this.animateCar(a,n,e,t)))}showWinMessage(e,t){let n;if(t instanceof HTMLElement){const a=Number(t.dataset.id);this.api.getCar(a).then((t=>{(0,c.isCar)(t)&&(n=t);const a=function(e,t){const n=new i.ElementBase({tag:"div",className:["dark-view"]}).element,a=new i.ElementBase({tag:"div",className:["message-container"]}).element,s=new i.ElementBase({tag:"p",className:["message"],textContent:e}).element;return s instanceof HTMLElement&&(s.style.textShadow=`${t} 3px 2px 15px`),a.append(s),n.append(a),document.body.append(n),n}(`${n.name} went first (${(e/1e3).toFixed(2)}s)!`,n.color);setTimeout((()=>{!function(e){e.remove()}(a)}),3e3)})).catch((e=>console.log(e)))}}saveWinner(e,t){return a(this,void 0,void 0,(function*(){if(t instanceof HTMLElement){const n=Number(t.dataset.id),a=yield this.apiWinners.getWinner(n);(0,c.isWinner)(a)?(console.log("record exists"),console.log(a),a.wins+=1,a.time>Number((e/1e3).toFixed(2))&&(a.time=Number((e/1e3).toFixed(2))),yield this.apiWinners.updateWinner(n,a)):yield this.apiWinners.addWinner({id:n,wins:1,time:Number((e/1e3).toFixed(2))})}}))}saveGarageState(){const e=this.pagination.pageNumber,t=this.selectedCarId;let n="",a="",s="",i="";const r=[...this.createRowContainer.children];r[0]instanceof HTMLInputElement&&r[1]instanceof HTMLInputElement&&(n=r[0].value,a=r[1].value);const o=[...this.updateRowContainer.children];o[0]instanceof HTMLInputElement&&o[1]instanceof HTMLInputElement&&(s=o[0].value,i=o[1].value);const c={pageNumber:e,selectedCarId:t,createCarName:n,createCarColor:a,updateCarName:s,updateCarColor:i};this.state.saveGarageState(c)}openWinnersHandler(e){this.saveGarageState(),e.openPage("winners")}createTopLevelButtons(e){const t=new i.ElementBase({tag:"div",className:["garage-page-top-buttons"]}).element,n=new r.Button({className:["winners-button","button"],textContent:"To Winners",handlerFunction:()=>{this.openWinnersHandler(e)}}).element;return t.append(n),t}}},656:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Router=void 0;const a=n(708),s=n(627),i=n(646);t.Router=class{constructor(e,t){this.routes=this.setRoutes(),this.main=e,this.state=t}openPage(e){void 0!==e&&history.pushState(null,"",e);const t=globalThis.location.pathname.slice(1),n=this.routes.find((e=>e.url===t));n&&n.handler()}setRoutes(){return[{url:"garage",handler:this.configureGaragePage.bind(this)},{url:"winners",handler:this.configureWinnersPage.bind(this)},{url:"",handler:this.configureGaragePage.bind(this)}]}configureGaragePage(){this.main.content&&(0,a.removeChildren)(this.main.main),this.main.content=new i.GaragePage(this.main,this,this.state)}configureWinnersPage(){this.main.content&&(0,a.removeChildren)(this.main.main),this.main.content=new s.Winners(this.main,this,this.state)}}},695:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.State=void 0;const a=n(765),s=n(24);t.State=class{constructor(){this.garageState=new a.LocalStorage("garage_state"),this.winnersState=new a.LocalStorage("winners_state")}saveGarageState(e){this.garageState.saveData(e)}saveWinnersState(e){this.winnersState.saveData(e)}getGarageState(){const e=this.garageState.getData();return(0,s.isGarageState)(e)?e:null}getWinnersState(){const e=this.winnersState.getData();return(0,s.isWinnersState)(e)?e:null}}},699:function(e,t){var n=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(s,i){function r(e){try{c(a.next(e))}catch(e){i(e)}}function o(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,o)}c((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.GarageAPI=void 0,t.GarageAPI=class{constructor(){this.url="http://127.0.0.1:3000/garage",this.urlEngine="http://127.0.0.1:3000/engine"}createCar(e){return n(this,void 0,void 0,(function*(){const t=yield fetch(this.url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return yield t.json()}))}getCars(e){return n(this,void 0,void 0,(function*(){const t=yield fetch(this.url+`?_page=${e}&_limit=7`,{method:"GET"});return yield t.json()}))}getAllCars(){return n(this,void 0,void 0,(function*(){const e=yield fetch(this.url,{method:"GET"});return yield e.json()}))}getCar(e){return n(this,void 0,void 0,(function*(){const t=yield fetch(this.url+`/${e}`,{method:"GET"});return yield t.json()}))}removeCar(e){return n(this,void 0,void 0,(function*(){yield fetch(this.url+`/${e}`,{method:"DELETE"})}))}updateCar(e,t){return n(this,void 0,void 0,(function*(){yield fetch(this.url+`/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}))}startEngine(e){return n(this,void 0,void 0,(function*(){const t=yield fetch(this.urlEngine+`/?id=${e}&status=started`,{method:"PATCH"});return yield t.json()}))}stopEngine(e){return n(this,void 0,void 0,(function*(){const t=yield fetch(this.urlEngine+`/?id=${e}&status=stopped`,{method:"PATCH"});return yield t.json()}))}driveEngine(e){return n(this,void 0,void 0,(function*(){return yield fetch(this.urlEngine+`/?id=${e}&status=drive`,{method:"PATCH"})}))}}},708:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ElementBase=void 0,t.removeChildren=function(e){[...e.children].forEach((e=>{e instanceof HTMLElement&&e.remove()}))},t.ElementBase=class{constructor(e){this.properties=e,this.element=this.createElement(),this.addClasses(),this.setContent()}createElement(){return document.createElement(this.properties.tag)}addClasses(){this.properties.className.forEach((e=>this.element.classList.add(e)))}setContent(){this.element.textContent=this.properties.textContent?this.properties.textContent:""}}},761:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.models=t.cars=void 0,t.cars=["Volvo","Volkswagen","Toyota","Ford","Mercedes","BMW","Kia","Audi","Skoda","Opel","Honda"],t.models=["DB9","S60","OV4","Passat","Q8","A7","X6","i8","G 63","SL 63","GT","Fusion","Focus","Mustang","Horizon","Pilot","N-Van"]},765:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStorage=void 0,t.LocalStorage=class{constructor(e){this.key=e}saveData(e){localStorage.setItem(this.key,JSON.stringify(e))}getData(){const e=localStorage.getItem(this.key);return null===e?null:JSON.parse(e)}}},768:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Main=void 0;const a=n(708);t.Main=class{constructor(){this.main=new a.ElementBase({tag:"main",className:["main"]}).element,this.configureView(),this.content=null}configureView(){document.body.append(this.main)}}},790:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});const a=n.p+"985ebb7e07a90fc62d295d47d2c1746e.svg"},805:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Pagination=void 0,t.Pagination=class{constructor(e,t){this.limit=e,this.pageNumber=t}setPrevButtonState(e){e.disabled=1===this.pageNumber}setNextButtonState(e,t){const n=Math.ceil(t/this.limit);e.disabled=this.pageNumber===n}}},888:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Button=void 0;const a=n(708);class s extends a.ElementBase{constructor(e){super({tag:"button",className:e.className,textContent:e.textContent}),this.addHandler(e.handlerFunction)}addHandler(e){try{this.element.addEventListener("click",(t=>{e(t)}))}catch(e){console.error(e)}}}t.Button=s},902:function(e,t){var n=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(s,i){function r(e){try{c(a.next(e))}catch(e){i(e)}}function o(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,o)}c((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.WinnersAPI=void 0,t.WinnersAPI=class{constructor(){this.url="http://127.0.0.1:3000/winners"}getWinners(e){return n(this,void 0,void 0,(function*(){const t=yield fetch(this.url+`?_page=${e}&_limit=10`,{method:"GET"});return[yield t.json(),t.headers]}))}sortWinners(e,t,a){return n(this,void 0,void 0,(function*(){const n=yield fetch(this.url+`?_page=${e}&_limit=10&_sort=${t}&_order=${a}`,{method:"GET"});return[yield n.json(),n.headers]}))}getWinner(e){return n(this,void 0,void 0,(function*(){const t=yield fetch(this.url+`/${e}`,{method:"GET"});return yield t.json()}))}updateWinner(e,t){return n(this,void 0,void 0,(function*(){const n={wins:t.wins,time:t.time};yield fetch(this.url+`/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}))}removeWinner(e){return n(this,void 0,void 0,(function*(){yield fetch(this.url+`/${e}`,{method:"DELETE"})}))}addWinner(e){return n(this,void 0,void 0,(function*(){const t=yield fetch(this.url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return yield t.json()}))}}}},t={};function n(a){var s=t[a];if(void 0!==s)return s.exports;var i=t[a]={exports:{}};return e[a].call(i.exports,i,i.exports,n),i.exports}n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var a=t.getElementsByTagName("script");if(a.length)for(var s=a.length-1;s>-1&&(!e||!/^http(s?):/.test(e));)e=a[s--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),(()=>{n(289);const e=n(768),t=n(656),a=n(695),s=new e.Main,i=new a.State,r=new t.Router(s,i);document.addEventListener("DOMContentLoaded",(()=>{r.openPage()})),globalThis.addEventListener("popstate",(()=>{r.openPage()}))})()})();
//# sourceMappingURL=bundle.ad725b4fac966ce841a7.js.map