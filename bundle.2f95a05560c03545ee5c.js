(()=>{"use strict";var e={24:(e,t)=>{function n(e){return"object"==typeof e&&null!==e&&"string"==typeof e.name}function a(e){return"object"==typeof e&&null!==e&&"number"==typeof e.wins}Object.defineProperty(t,"__esModule",{value:!0}),t.isCar=n,t.isCars=function(e){var t;return!(!Array.isArray(e)||null===e)&&(!(Array.isArray(e)&&!e.every((e=>n(e))))&&("string"==typeof(null===(t=e[0])||void 0===t?void 0:t.name)||0===e.length))},t.isEngine=function(e){return"object"==typeof e&&null!==e&&"number"==typeof e.velocity},t.isWinner=a,t.isWinners=function(e){var t;return!(!Array.isArray(e)||null===e)&&(!(Array.isArray(e)&&!e.every((e=>a(e))))&&("number"==typeof(null===(t=e[0])||void 0===t?void 0:t.wins)||0===e.length))},t.isGarageState=function(e){return"object"==typeof e&&null!==e&&"string"==typeof e.createCarName},t.isWinnersState=function(e){return"object"==typeof e&&null!==e&&"string"==typeof e.winsSort}},76:function(e,t,n){var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function s(e){try{c(a.next(e))}catch(e){i(e)}}function o(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}c((a=a.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Garage=void 0,t.createCarsContainer=g,t.createCarImage=d;const i=n(699),s=n(24),o=n(708),c=n(888),l=r(n(172)),u=n(761),h=n(902);function g(){return new o.ElementBase({tag:"div",className:["cars"]}).element}function d(e){const t=new o.ElementBase({tag:"span",className:["car-image"]}).element;return t.innerHTML=`<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"\n\t viewBox="0 0 17.485 17.485" xml:space="preserve">\n<g>\n\t<g>\n\t\t<path style="fill:${e};" d="M17.477,8.149c-0.079-0.739-3.976-0.581-3.976-0.581L11.853,5.23H4.275L3.168,7.567H0v2.404\n\t\t\tl2.029,0.682c0.123-0.836,0.843-1.48,1.711-1.48c0.939,0,1.704,0.751,1.73,1.685l6.62,0.041c0.004-0.951,0.779-1.726,1.733-1.726\n\t\t\tc0.854,0,1.563,0.623,1.704,1.439l1.479-0.17C17.006,10.442,17.556,8.887,17.477,8.149z M4.007,7.568l0.746-1.771h2.864\n\t\t\tl0.471,1.771H4.007z M8.484,7.568L8.01,5.797h3.67l1.137,1.771H8.484z"/>\n\t\t<circle style="fill:#030104;" cx="3.759" cy="10.966" r="1.289"/>\n\t\t<circle style="fill:#030104;" cx="13.827" cy="10.9" r="1.29"/>\n\t</g>\n</g>\n</svg>`,t}function m(){const e=["A","B","C","D","E","F",0,1,2,3,4,5,6,7,8,9];let t="";for(let n=0;n<6;n+=1)t+=e[Math.floor(16*Math.random())];return`#${t}`}function p(e,t){const n=t.querySelector(".car-image");n instanceof HTMLElement&&(n.style.transform=`translate(${e}px)`)}function f(e){const t=[...e.children];v(t),function(e){const t=e[0];t instanceof HTMLButtonElement&&(t.disabled=!1)}(t)}function v(e){const t=e[1];t instanceof HTMLButtonElement&&(t.disabled=!0)}t.Garage=class{constructor(e){this.garagePage=e,this.apiGarage=new i.GarageAPI,this.apiWinners=new h.WinnersAPI,this.carsContainer=g()}getAllCarsCount(){return a(this,void 0,void 0,(function*(){let e;const t=yield this.apiGarage.getAllCars();return(0,s.isCars)(t)?(e=t.length,e):0}))}populateGarage(e){return a(this,void 0,void 0,(function*(){const t=yield this.apiGarage.getCars(e,this.garagePage.pagination.limit);(0,s.isCars)(t)&&t.forEach((e=>this.renderCarRecord(e)))}))}renderCarRecord(e){const t=new o.ElementBase({tag:"div",className:["car-row"]}).element;t.dataset.id=e.id.toString();const n=this.createCarRecordTopMenu(e.name),a=this.createCarMainContent(e.color);t.append(n,a),this.carsContainer.append(t)}createCarRecordTopMenu(e){const t=new o.ElementBase({tag:"div",className:["car-menu"]}).element,n=new c.Button({className:["select-button"],textContent:"Select",handlerFunction:e=>{this.selectCarRecordHandler(e).then((()=>this.garagePage.saveGarageState())).catch((e=>console.log(e)))}}).element,a=new c.Button({className:["remove-button"],textContent:"Remove",handlerFunction:e=>{this.removeCarRecordHandler(e)}}).element,r=new o.ElementBase({tag:"p",className:["car-name"],textContent:e}).element;return t.append(n,a,r),t}createCarMainContent(e){const t=new o.ElementBase({tag:"div",className:["car-main"]}).element,n=new c.Button({className:["start-button"],textContent:"A",handlerFunction:e=>{this.startCarHandler(e)}}).element,a=new c.Button({className:["stop-button"],textContent:"B",handlerFunction:e=>{this.stopCarHandler(e)}}).element,r=d(e),i=new o.ElementBase({tag:"span",className:["flag-image"]}).element;return i.style.backgroundImage=`url(${l.default})`,t.append(n,a,r,i),v(t.children),t}selectCarRecordHandler(e){return a(this,void 0,void 0,(function*(){var t;if(e){const n=e.target;if(n instanceof Node){const e=null===(t=n.parentElement)||void 0===t?void 0:t.parentElement;if(e instanceof Element&&e.dataset){this.garagePage.selectedCarId=Number(e.dataset.id);const t=yield this.apiGarage.getCar(this.garagePage.selectedCarId);if((0,s.isCar)(t)){const e=[...this.garagePage.updateRowContainer.children];e[0]instanceof HTMLInputElement&&e[1]instanceof HTMLInputElement&&(e[0].value=t.name,e[1].value=t.color)}}}}}))}createCarHandler(){return a(this,void 0,void 0,(function*(){const e={name:"",color:""},t=[...this.garagePage.createRowContainer.children];if(t[0]instanceof HTMLInputElement&&t[1]instanceof HTMLInputElement){const n=t[0].value,a=t[1].value;e.name=n,e.color=a;const r=yield this.apiGarage.createCar(e);this.garagePage.carsNumber+=1,this.garagePage.setCarsNumber(this.garagePage.carsNumber),this.getCarsCountOnPage()<this.garagePage.pagination.limit&&(0,s.isCar)(r)&&this.renderCarRecord(r),this.updateNextPageButtonState()}}))}removeCarRecordHandler(e){return a(this,void 0,void 0,(function*(){var t;let n;if(e){const a=e.target;if(a instanceof Node){const e=null===(t=a.parentElement)||void 0===t?void 0:t.parentElement;e instanceof Element&&e.dataset&&(n=Number(e.dataset.id),yield this.apiGarage.removeCar(n),yield this.apiWinners.removeWinner(n),this.garagePage.carsNumber-=1,this.garagePage.setCarsNumber(this.garagePage.carsNumber),this.garagePage.clearCars(),yield this.populateGarage(this.garagePage.pagination.pageNumber),this.updateNextPageButtonState())}}}))}updateNextPageButtonState(){const e=this.garagePage.garageContainer.querySelector(".next-button");e instanceof HTMLButtonElement&&this.garagePage.pagination.setNextButtonState(e,this.garagePage.carsNumber)}updateCarRecordHandler(){return a(this,void 0,void 0,(function*(){const e=[...this.garagePage.updateRowContainer.children];let t,n;e[0]instanceof HTMLInputElement&&e[1]instanceof HTMLInputElement&&(t=e[0].value,n=e[1].value,yield this.apiGarage.updateCar(this.garagePage.selectedCarId,{name:t,color:n}),this.garagePage.clearCars(),yield this.populateGarage(this.garagePage.pagination.pageNumber))}))}startCarHandler(e){var t;if(e){this.garagePage.isRace=!1;const n=e.target;if(n instanceof Node){const e=null===(t=n.parentElement)||void 0===t?void 0:t.parentElement;if(e instanceof Element&&e.dataset){const t=Number(e.dataset.id);this.apiGarage.startEngine(t).then((n=>{if((0,s.isEngine)(n)){const a=n.distance/n.velocity;e.dataset.state="",this.startCar(a,e),this.apiGarage.driveEngine(t).then((t=>{t.ok||(e.dataset.state="stopped")})).catch((e=>console.log(e)))}})).catch((e=>console.log(e)))}}}}startCar(e,t){const n=performance.now();!function(e){const t=[...e.children];(function(e){const t=e[0];t instanceof HTMLButtonElement&&(t.disabled=!0)})(t),function(e){const t=e[1];t instanceof HTMLButtonElement&&(t.disabled=!1)}(t)}([...t.children][1]),requestAnimationFrame((a=>this.animateCar(a,n,e,t)))}stopCarHandler(e){var t;if(e){const n=e.target;if(n instanceof Node){const e=null===(t=n.parentElement)||void 0===t?void 0:t.parentElement;if(e instanceof Element&&e.dataset){const t=Number(e.dataset.id);this.apiGarage.stopEngine(t).then((t=>{(0,s.isEngine)(t)&&(e.dataset.state="stopped",p(0,e),f([...e.children][1]))})).catch((e=>console.log(e)))}}}}animateCar(e,t,n,a){const r=(e-t)/n,i=r*(a.clientWidth-130);r<1&&a instanceof HTMLElement?"stopped"!==a.dataset.state&&(p(i,a),requestAnimationFrame((e=>this.animateCar(e,t,n,a)))):this.garagePage.isRace&&null===this.garagePage.winner&&(a instanceof HTMLElement&&(this.garagePage.winner=a),this.garagePage.showWinMessage(n,a),this.garagePage.saveWinner(n,a).then((e=>console.log(e))).catch((e=>console.log(e))))}getCarsCountOnPage(){return this.carsContainer.children.length}startRaceHandler(){this.garagePage.winner=null;const e=[...this.carsContainer.children],t=[];for(let n=0;n<this.carsContainer.children.length;n+=1){const a=e[n];if(a instanceof HTMLElement){const e=Number(a.dataset.id);t.push(this.apiGarage.startEngine(e))}}Promise.all(t).then((t=>{e.forEach(((e,n)=>{if(e instanceof HTMLElement&&(e.dataset.state="started",this.garagePage.isRace=!0),(0,s.isEngine)(t[n])){const a=t[n].distance/t[n].velocity;if(this.startCar(a,e),e instanceof HTMLElement){const t=Number(e.dataset.id);this.apiGarage.driveEngine(t).then((t=>{t.ok||(e.dataset.state="stopped")})).catch((e=>console.log(e)))}}}))})).catch((e=>console.log(e)))}stopAllCarsHandler(){const e=[...this.carsContainer.children],t=this.carsContainer.children.length,n=[];for(let a=0;a<t;a+=1){const t=e[a];if(t instanceof HTMLElement){const e=Number(t.dataset.id);n.push(this.apiGarage.stopEngine(e))}}Promise.all(n).then((()=>{e.forEach((e=>{e instanceof HTMLElement&&(e.dataset.state="stopped",p(0,e),f([...e.children][1]))}))})).catch((e=>console.log(e)))}generateRandomCars(){return a(this,void 0,void 0,(function*(){for(let e=0;e<100;e+=1){const e={name:u.cars[Math.floor(Math.random()*u.cars.length)]+" "+u.models[Math.floor(Math.random()*u.models.length)],color:m()},t=yield this.apiGarage.createCar(e);this.getCarsCountOnPage()<this.garagePage.pagination.limit&&(0,s.isCar)(t)&&this.renderCarRecord(t)}this.garagePage.carsNumber=yield this.getAllCarsCount(),this.garagePage.setCarsNumber(this.garagePage.carsNumber),this.updateNextPageButtonState()}))}}},172:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});const a=n.p+"33d2f757bd156b2a4fc9f82b759f4619.svg"},257:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});const a=n.p+"19102e4d9f16195082da72d321083b2d.svg"},289:(e,t,n)=>{n.r(t)},602:function(e,t,n){var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function s(e){try{c(a.next(e))}catch(e){i(e)}}function o(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}c((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.GaragePage=void 0;const r=n(708),i=n(888),s=n(699),o=n(24),c=n(761),l=n(902),u=n(805),h=n(76),g=n(76);t.GaragePage=class{constructor(e,t,n){this.state=n,this.winner=null,this.isRace=!1,this.carsNumber=0,this.apiGarage=new s.GarageAPI,this.apiWinners=new l.WinnersAPI;const a=this.state.getGarageState();if(a){this.selectedCarId=a.selectedCarId;const e=a.pageNumber;this.pagination=new u.Pagination(c.ItemsPerPageGarage,e)}else this.pagination=new u.Pagination(c.ItemsPerPageGarage,1),this.selectedCarId=0;this.createRowContainer=new r.ElementBase({tag:"div",className:["create-car-row"]}).element,this.createCarForm(),this.updateRowContainer=new r.ElementBase({tag:"div",className:["update-car-row"]}).element,this.updateCarForm(),this.garage=new h.Garage(this),this.garageContainer=new r.ElementBase({tag:"div",className:["garage"]}).element,this.getAllCarsCount().then((n=>{this.carsNumber=n,this.createGarageContainer(this.pagination.pageNumber),this.configurePage(e,t)})).catch((e=>console.log(e)))}configurePage(e,t){const n=this.createGaragePageMenu(t);e.main instanceof Element&&e.main.append(n,this.garageContainer),this.garage.populateGarage(this.pagination.pageNumber).then((()=>{})).catch((()=>{}))}createGaragePageMenu(e){const t=new r.ElementBase({tag:"div",className:["garage-page-menu"]}).element;return t.append(this.createTopLevelButtons(e),this.createForm(),this.createBottomLevelButtons()),t}createCarForm(){const e=new r.ElementBase({tag:"input",className:["create-car-input"]}).element,t=new r.ElementBase({tag:"input",className:["create-car-color"]}).element,n=new i.Button({className:["create-car"],textContent:"Create",handlerFunction:()=>{this.garage.createCarHandler().then((()=>{}),(e=>console.log(e)))}}).element;e instanceof HTMLInputElement&&t instanceof HTMLInputElement&&(t.type="color",this.fillInCreateFormFromStorage(e,t),e.addEventListener("change",(()=>this.saveGarageState())),t.addEventListener("change",(()=>this.saveGarageState()))),this.createRowContainer.append(e,t,n)}createForm(){const e=new r.ElementBase({tag:"div",className:["garage-form"]}).element;return e.append(this.createRowContainer,this.updateRowContainer),e}updateCarForm(){const e=new r.ElementBase({tag:"input",className:["update-car-input"]}).element,t=new r.ElementBase({tag:"input",className:["update-car-color"]}).element,n=new i.Button({className:["update-car"],textContent:"Update",handlerFunction:()=>{this.garage.updateCarRecordHandler().then((e=>e),(e=>console.log(e)))}}).element;e instanceof HTMLInputElement&&t instanceof HTMLInputElement&&(this.fillInUpdateFromStorage(e,t),t.type="color",e.addEventListener("change",(()=>this.saveGarageState())),t.addEventListener("change",(()=>this.saveGarageState()))),this.updateRowContainer.append(e,t,n)}fillInCreateFormFromStorage(e,t){const n=this.state.getGarageState();n&&(e.value=n.createCarName,t.value=n.createCarColor)}fillInUpdateFromStorage(e,t){const n=this.state.getGarageState();n&&(e.value=n.updateCarName,t.value=n.updateCarColor)}createGarageContainer(e){const t=new r.ElementBase({tag:"p",className:["garage-title"],textContent:`Garage (${this.carsNumber})`}).element,n=new r.ElementBase({tag:"p",className:["garage-page-number"],textContent:`Page #${e}`}).element;this.garageContainer.append(t,n,this.garage.carsContainer,this.createPaginationButtons())}clearGarage(){[...this.garageContainer.children].forEach((e=>e.remove()))}clearCars(){[...this.garage.carsContainer.children].forEach((e=>e.remove()))}createPaginationButtons(){const e=new r.ElementBase({tag:"div",className:["pagination-buttons"]}).element,t=new i.Button({className:["prev-button","button"],textContent:"Prev",handlerFunction:()=>{this.clearGarage(),this.garage.carsContainer=(0,g.createCarsContainer)(),this.pagination.pageNumber-=1,this.createGarageContainer(this.pagination.pageNumber),this.garage.populateGarage(this.pagination.pageNumber).then((()=>this.saveGarageState())).catch((e=>console.log(e)))}}).element;t instanceof HTMLButtonElement&&this.pagination.setPrevButtonState(t);const n=new i.Button({className:["next-button","button"],textContent:"Next",handlerFunction:()=>{this.clearGarage(),this.garage.carsContainer=(0,g.createCarsContainer)(),this.pagination.pageNumber+=1,this.createGarageContainer(this.pagination.pageNumber),this.garage.populateGarage(this.pagination.pageNumber).then((()=>this.saveGarageState())).catch((e=>console.log(e)))}}).element;return n instanceof HTMLButtonElement&&this.pagination.setNextButtonState(n,this.carsNumber),e.append(t,n),e}createTopLevelButtons(e){const t=new r.ElementBase({tag:"div",className:["garage-page-top-buttons"]}).element,n=new i.Button({className:["winners-button","button"],textContent:"To Winners",handlerFunction:()=>{this.openWinnersHandler(e)}}).element;return t.append(n),t}createBottomLevelButtons(){const e=new r.ElementBase({tag:"div",className:["garage-page-bottom-buttons"]}).element,t=new i.Button({className:["race-button","button"],textContent:"Race",handlerFunction:()=>{this.garage.startRaceHandler()}}).element,n=new i.Button({className:["reset-button","button"],textContent:"Reset",handlerFunction:()=>{this.garage.stopAllCarsHandler()}}).element,a=new i.Button({className:["generate-cars-button","button"],textContent:"Generate Cars",handlerFunction:()=>{this.garage.generateRandomCars()}}).element;return e.append(t,n,a),e}getCarsCountOnPage(){return this.garage.carsContainer.children.length}getAllCarsCount(){return a(this,void 0,void 0,(function*(){let e;const t=yield this.apiGarage.getAllCars();return(0,o.isCars)(t)?(e=t.length,e):0}))}setCarsNumber(e){[...this.garageContainer.children][0].textContent=`Garage (${e})`}saveGarageState(){const e=this.pagination.pageNumber,t=this.selectedCarId;let n="",a="",r="",i="";const s=[...this.createRowContainer.children];s[0]instanceof HTMLInputElement&&s[1]instanceof HTMLInputElement&&(n=s[0].value,a=s[1].value);const o=[...this.updateRowContainer.children];o[0]instanceof HTMLInputElement&&o[1]instanceof HTMLInputElement&&(r=o[0].value,i=o[1].value);const c={pageNumber:e,selectedCarId:t,createCarName:n,createCarColor:a,updateCarName:r,updateCarColor:i};this.state.saveGarageState(c)}showWinMessage(e,t){let n;if(t instanceof HTMLElement){const a=Number(t.dataset.id);this.apiGarage.getCar(a).then((t=>{(0,o.isCar)(t)&&(n=t);const a=function(e,t){const n=new r.ElementBase({tag:"div",className:["dark-view"]}).element,a=new r.ElementBase({tag:"div",className:["message-container"]}).element,i=new r.ElementBase({tag:"p",className:["message"],textContent:e}).element;return i instanceof HTMLElement&&(i.style.textShadow=`${t} 3px 2px 15px`),a.append(i),n.append(a),document.body.append(n),n}(`${n.name} went first (${(e/1e3).toFixed(2)}s)!`,n.color);setTimeout((()=>{!function(e){e.remove()}(a)}),3e3)})).catch((e=>console.log(e)))}}openWinnersHandler(e){this.saveGarageState(),e.openPage("winners")}saveWinner(e,t){return a(this,void 0,void 0,(function*(){if(t instanceof HTMLElement){const n=Number(t.dataset.id),a=yield this.apiWinners.getWinner(n);(0,o.isWinner)(a)?(a.wins+=1,a.time>Number((e/1e3).toFixed(2))&&(a.time=Number((e/1e3).toFixed(2))),yield this.apiWinners.updateWinner(n,a)):yield this.apiWinners.addWinner({id:n,wins:1,time:Number((e/1e3).toFixed(2))})}}))}}},627:function(e,t,n){var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function s(e){try{c(a.next(e))}catch(e){i(e)}}function o(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}c((a=a.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Winners=void 0;const i=n(708),s=n(888),o=n(902),c=n(699),l=n(24),u=n(76),h=r(n(790)),g=r(n(257)),d=n(805),m=n(761);function p(e){e instanceof HTMLElement&&(e.dataset.sort="",[...e.children].forEach((e=>e.remove())))}function f(e){let t="",n="";return e.timeSort?(t="time",n=e.timeSort):e.winsSort&&(t="wins",n=e.winsSort),[t,n]}function v(e){const t=e.dataset.sort;"ASC"===t&&e instanceof HTMLElement?([...e.children].forEach((e=>e.remove())),e.append(C())):"DESC"===t&&e instanceof HTMLElement&&([...e.children].forEach((e=>e.remove())),e.append(w()))}function C(){const e=new i.ElementBase({tag:"span",className:["sort-icon-up"]}).element;return e instanceof HTMLElement&&(e.style.backgroundImage=`url(${h.default})`),e}function w(){const e=new i.ElementBase({tag:"span",className:["sort-icon-down"]}).element;return e instanceof HTMLElement&&(e.style.backgroundImage=`url(${g.default})`),e}t.Winners=class{constructor(e,t,n){this.state=n,this.winnersCount=0,this.api=new o.WinnersAPI,this.apiCars=new c.GarageAPI;const a=this.state.getWinnersState(),r=a?a.pageNumber:1;this.pagination=new d.Pagination(m.ItemsPerPageWinners,r),this.winnersContainer=new i.ElementBase({tag:"div",className:["winners-container"]}).element,this.winners=new i.ElementBase({tag:"div",className:["winners"]}).element,this.configurePage(e,t)}configurePage(e,t){const n=this.createWinnersPageMenu(t);e.main instanceof Element&&(e.main.append(n,this.winnersContainer),this.createWinnersComponents().then((()=>this.createWinnersContainer(this.pagination.pageNumber))).catch((e=>console.log(e))))}createWinnersContainer(e){const t=new i.ElementBase({tag:"p",className:["winners-title"],textContent:`Winners (${this.winnersCount})`}).element,n=new i.ElementBase({tag:"p",className:["winners-page-number"],textContent:`Page #${e}`}).element;this.winnersContainer.append(t,n,this.winners,this.createPaginationButtons())}createPaginationButtons(){const e=new i.ElementBase({tag:"div",className:["pagination-buttons"]}).element,t=new s.Button({className:["prev-button","button"],textContent:"Prev",handlerFunction:()=>{this.prevButtonHandler()}}).element,n=new s.Button({className:["next-button","button"],textContent:"Next",handlerFunction:()=>{this.nextButtonHandler()}}).element;return t instanceof HTMLButtonElement&&n instanceof HTMLButtonElement&&(this.pagination.setPrevButtonState(t),this.pagination.setNextButtonState(n,this.winnersCount)),e.append(t,n),e}nextButtonHandler(){this.clearWinnersContainer(),this.clearWinners(),this.pagination.pageNumber+=1,this.createWinnersComponents().then((()=>{this.createWinnersContainer(this.pagination.pageNumber),this.saveWinnersState()})).catch((e=>console.log(e)))}prevButtonHandler(){this.clearWinnersContainer(),this.clearWinners(),this.pagination.pageNumber-=1,this.createWinnersComponents().then((()=>{this.createWinnersContainer(this.pagination.pageNumber),this.saveWinnersState()})).catch((e=>console.log(e)))}createWinnersComponents(){return a(this,void 0,void 0,(function*(){this.createTableHeader(),yield this.populateWinnersTable()}))}createTableHeader(){const e=new i.ElementBase({tag:"p",className:["header-number","winners-header"],textContent:"Number"}).element,t=new i.ElementBase({tag:"p",className:["header-name","winners-header"],textContent:"Name"}).element,n=new i.ElementBase({tag:"p",className:["header-car","winners-header"],textContent:"Car"}).element,a=new i.ElementBase({tag:"p",className:["header-time","winners-header"],textContent:"Wins"}).element,r=new i.ElementBase({tag:"p",className:["header-time","winners-header"],textContent:"Best Time"}).element;a.addEventListener("click",(()=>{r&&p(r),this.showSortedWinners(a,"wins"),this.saveWinnersState()})),r.addEventListener("click",(()=>{a&&p(a),this.showSortedWinners(r,"time"),this.saveWinnersState()})),this.setSortingFromState(a,r),this.winners.append(e,t,n,a,r)}showSortedWinners(e,t){this.clearWinnersWithoutHeader();let n="";e.dataset.sort&&"DESC"!==e.dataset.sort?(n="DESC",e.dataset.sort="DESC",e instanceof HTMLElement&&([...e.children].forEach((e=>e.remove())),e.append(w()))):(n="ASC",e.dataset.sort="ASC",e instanceof HTMLElement&&([...e.children].forEach((e=>e.remove())),e.append(C()))),this.sortByColumnHandler(t,n).then((e=>console.log(e))).catch((e=>console.log(e)))}sortByColumnHandler(e,t){return a(this,void 0,void 0,(function*(){const n=(yield this.api.sortWinners(this.pagination.pageNumber,e,t,this.pagination.limit))[0],a=[];(0,l.isWinners)(n)&&(n.forEach((e=>{a.push(this.apiCars.getCar(e.id))})),Promise.all(a).then((e=>e.forEach(((e,t)=>{(0,l.isCar)(e)&&this.createWinnerRow(t+1,e,n[t])})))).catch((e=>console.log(e))))}))}createWinnerRow(e,t,n){const a=new i.ElementBase({tag:"p",className:["data-number","data"],textContent:`${e}`}).element,r=new i.ElementBase({tag:"p",className:["data-name","data"],textContent:`${t.name}`}).element,s=(0,u.createCarImage)(t.color),o=new i.ElementBase({tag:"p",className:["data-wins","data"],textContent:`${n.wins}`}).element,c=new i.ElementBase({tag:"p",className:["data-time","data"],textContent:`${n.time}`}).element;this.winners.append(a,r,s,o,c)}populateWinnersTable(){return a(this,void 0,void 0,(function*(){const e=yield this.getWinnersDataBasedOnState(),t=e[0],n=e[1];n instanceof Headers&&(this.winnersCount=Number(n.get("X-Total-Count")));const a=[];(0,l.isWinners)(t)&&(t.forEach((e=>{a.push(this.apiCars.getCar(e.id))})),Promise.all(a).then((e=>e.forEach(((e,n)=>{(0,l.isCar)(e)&&this.createWinnerRow(n+1,e,t[n])})))).catch((e=>console.log(e))))}))}getWinnersDataBasedOnState(){return a(this,void 0,void 0,(function*(){let e;const t=this.state.getWinnersState();if(t){const n=f(t)[0],a=f(t)[1];e=n&&a?yield this.api.sortWinners(this.pagination.pageNumber,n,a,this.pagination.limit):yield this.api.getWinners(this.pagination.pageNumber,this.pagination.limit)}else e=yield this.api.getWinners(this.pagination.pageNumber,this.pagination.limit);return e}))}clearWinnersContainer(){[...this.winnersContainer.children].forEach((e=>e.remove()))}clearWinners(){[...this.winners.children].forEach((e=>e.remove()))}clearWinnersWithoutHeader(){[...this.winners.children].slice(5).forEach((e=>e.remove()))}saveWinnersState(){const e=this.pagination.pageNumber;let t="",n="";const a=[...this.winners.children];a[3]instanceof HTMLElement&&(t=a[3].dataset.sort?a[3].dataset.sort:""),a[4]instanceof HTMLElement&&(n=a[4].dataset.sort?a[4].dataset.sort:"");const r={pageNumber:e,winsSort:t,timeSort:n};this.state.saveWinnersState(r)}createTopLevelButtons(e){return new s.Button({className:["garage-button","button"],textContent:"To Garage",handlerFunction:()=>{this.saveWinnersState(),e.openPage("/")}}).element}createWinnersPageMenu(e){const t=new i.ElementBase({tag:"div",className:["winners-page-menu"]}).element;return t.append(this.createTopLevelButtons(e)),t}setSortingFromState(e,t){const n=this.state.getWinnersState();n&&(e.dataset.sort=n.winsSort,t.dataset.sort=n.timeSort,v(e),v(t))}}},656:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Router=void 0;const a=n(708),r=n(627),i=n(602);t.Router=class{constructor(e,t){this.routes=this.setRoutes(),this.main=e,this.state=t}openPage(e){void 0!==e&&history.pushState(null,"",e);const t=globalThis.location.pathname.slice(1),n=this.routes.find((e=>e.url===t));n&&n.handler()}setRoutes(){return[{url:"garage",handler:this.configureGaragePage.bind(this)},{url:"winners",handler:this.configureWinnersPage.bind(this)},{url:"",handler:this.configureGaragePage.bind(this)}]}configureGaragePage(){this.main.content&&(0,a.removeChildren)(this.main.main),this.main.content=new i.GaragePage(this.main,this,this.state)}configureWinnersPage(){this.main.content&&(0,a.removeChildren)(this.main.main),this.main.content=new r.Winners(this.main,this,this.state)}}},675:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.App=void 0;const a=n(656),r=n(768),i=n(695);t.App=class{constructor(){this.main=new r.Main,this.state=new i.State,this.router=new a.Router(this.main,this.state),document.addEventListener("DOMContentLoaded",(()=>{this.router.openPage()})),globalThis.addEventListener("popstate",(()=>{console.log("popstate event triggered"),this.router.openPage()}))}}},695:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.State=void 0;const a=n(765),r=n(24);t.State=class{constructor(){this.garageState=new a.LocalStorage("garage_state"),this.winnersState=new a.LocalStorage("winners_state")}saveGarageState(e){this.garageState.saveData(e)}saveWinnersState(e){this.winnersState.saveData(e)}getGarageState(){const e=this.garageState.getData();return(0,r.isGarageState)(e)?e:null}getWinnersState(){const e=this.winnersState.getData();return(0,r.isWinnersState)(e)?e:null}}},699:function(e,t){var n=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function s(e){try{c(a.next(e))}catch(e){i(e)}}function o(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}c((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.GarageAPI=void 0,t.GarageAPI=class{constructor(){this.urlGarage="http://127.0.0.1:3000/garage",this.urlEngine="http://127.0.0.1:3000/engine"}createCar(e){return n(this,void 0,void 0,(function*(){const t=yield fetch(this.urlGarage,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return yield t.json()}))}getCars(e,t){return n(this,void 0,void 0,(function*(){const n=yield fetch(this.urlGarage+`?_page=${e}&_limit=${t}`,{method:"GET"});return yield n.json()}))}getAllCars(){return n(this,void 0,void 0,(function*(){const e=yield fetch(this.urlGarage,{method:"GET"});return yield e.json()}))}getCar(e){return n(this,void 0,void 0,(function*(){const t=yield fetch(this.urlGarage+`/${e}`,{method:"GET"});return yield t.json()}))}removeCar(e){return n(this,void 0,void 0,(function*(){yield fetch(this.urlGarage+`/${e}`,{method:"DELETE"})}))}updateCar(e,t){return n(this,void 0,void 0,(function*(){yield fetch(this.urlGarage+`/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}))}startEngine(e){return n(this,void 0,void 0,(function*(){const t=yield fetch(this.urlEngine+`/?id=${e}&status=started`,{method:"PATCH"});return yield t.json()}))}stopEngine(e){return n(this,void 0,void 0,(function*(){const t=yield fetch(this.urlEngine+`/?id=${e}&status=stopped`,{method:"PATCH"});return yield t.json()}))}driveEngine(e){return n(this,void 0,void 0,(function*(){return yield fetch(this.urlEngine+`/?id=${e}&status=drive`,{method:"PATCH"})}))}}},708:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ElementBase=void 0,t.removeChildren=function(e){[...e.children].forEach((e=>{e instanceof HTMLElement&&e.remove()}))},t.ElementBase=class{constructor(e){this.properties=e,this.element=this.createElement(),this.addClasses(),this.setContent()}createElement(){return document.createElement(this.properties.tag)}addClasses(){this.properties.className.forEach((e=>this.element.classList.add(e)))}setContent(){this.element.textContent=this.properties.textContent?this.properties.textContent:""}}},761:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ItemsPerPageWinners=t.ItemsPerPageGarage=t.models=t.cars=void 0,t.cars=["Volvo","Volkswagen","Toyota","Ford","Mercedes","BMW","Kia","Audi","Skoda","Opel","Honda"],t.models=["DB9","S60","OV4","Passat","Q8","A7","X6","i8","G 63","SL 63","GT","Fusion","Focus","Mustang","Horizon","Pilot","N-Van"],t.ItemsPerPageGarage=7,t.ItemsPerPageWinners=10},765:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStorage=void 0,t.LocalStorage=class{constructor(e){this.key=e}saveData(e){localStorage.setItem(this.key,JSON.stringify(e))}getData(){const e=localStorage.getItem(this.key);return null===e?null:JSON.parse(e)}}},768:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Main=void 0;const a=n(708);t.Main=class{constructor(){this.main=new a.ElementBase({tag:"main",className:["main"]}).element,this.configureView(),this.content=null}configureView(){document.body.append(this.main)}}},790:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});const a=n.p+"5133cd7a92604546644f13ecd77eeb9c.svg"},805:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Pagination=void 0,t.Pagination=class{constructor(e,t){this.limit=e,this.pageNumber=t}setPrevButtonState(e){e.disabled=1===this.pageNumber}setNextButtonState(e,t){const n=Math.ceil(t/this.limit);e.disabled=this.pageNumber===n}}},888:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Button=void 0;const a=n(708);class r extends a.ElementBase{constructor(e){super({tag:"button",className:e.className,textContent:e.textContent}),this.addHandler(e.handlerFunction)}addHandler(e){try{this.element.addEventListener("click",(t=>{e(t)}))}catch(e){console.error(e)}}}t.Button=r},902:function(e,t){var n=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function s(e){try{c(a.next(e))}catch(e){i(e)}}function o(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}c((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.WinnersAPI=void 0,t.WinnersAPI=class{constructor(){this.url="http://127.0.0.1:3000/winners"}getWinners(e,t){return n(this,void 0,void 0,(function*(){const n=yield fetch(this.url+`?_page=${e}&_limit=${t}`,{method:"GET"});return[yield n.json(),n.headers]}))}sortWinners(e,t,a,r){return n(this,void 0,void 0,(function*(){const n=yield fetch(this.url+`?_page=${e}&_limit=${r}&_sort=${t}&_order=${a}`,{method:"GET"});return[yield n.json(),n.headers]}))}getWinner(e){return n(this,void 0,void 0,(function*(){const t=yield fetch(this.url+`/${e}`,{method:"GET"});return yield t.json()}))}updateWinner(e,t){return n(this,void 0,void 0,(function*(){const n={wins:t.wins,time:t.time};yield fetch(this.url+`/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}))}removeWinner(e){return n(this,void 0,void 0,(function*(){yield fetch(this.url+`/${e}`,{method:"DELETE"})}))}addWinner(e){return n(this,void 0,void 0,(function*(){const t=yield fetch(this.url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return yield t.json()}))}}}},t={};function n(a){var r=t[a];if(void 0!==r)return r.exports;var i=t[a]={exports:{}};return e[a].call(i.exports,i,i.exports,n),i.exports}n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var a=t.getElementsByTagName("script");if(a.length)for(var r=a.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=a[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),n(289),new(n(675).App)})();
//# sourceMappingURL=bundle.2f95a05560c03545ee5c.js.map